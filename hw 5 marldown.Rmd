---
title: "hw 5 markdown"
author: "ryan"
date: "December 9, 2015"
output: html_document
---
below is the code used to preform ANOVA and completee hw5 

```{r, eval=FALSE}
library(DBI)
library(RPostgreSQL)
library(dplyr)
library(ggplot2)
library(plotrix)
library(Hmisc)
library(car)
library(moments)
library(reshape2)

#pulled csv from folder not db. it was not specified in class touse data from db or directory
## must set wd for this to work

setwd("Class 3302/Data/")

flights=read.csv("On_Time_On_Time_Performance_2013_2.csv")

flights.delayed = flights %>% select(Year, 
                                  Month, 
                                  ArrDelay, 
                                  CarrierDelay, 
                                  WeatherDelay, 
                                  NASDelay, 
                                  SecurityDelay,
                                  LateAircraftDelay)
tail(flightDelays)

#viewing data 
head(flights)

# Cleaning & melting data 
## had assitance with metling 
flights.delayed$ID = paste(row.names(flights.delayed), 
                           flights.delayed$Year, 
                           flights.delayed$Month, 
                           feb="")
View(flights.delayed)

flights.delayed = flights.delayed[, 3:9]

flights.delayed.m = melt (flights.delayed, variable.name = "TypeOfDelay", 
                          value.name = "ArrDelay", 
                          id.vars = "ID")

View(flights.delayed.m)
head(flights.delayed.m)
tail(flights.delayed.m)
summary(flights.delayed.m)


#getting rid of the non values and applying it to the the data frame 
##helped by collin and matt for following steps 

na.zero <- function (x) {
  x[is.na(x)] <- 0
  return(x)
}

flights.delayed.m = na.zero(flights.delayed.m)

summary(flights.delayed.m)
```

first we pull teh data from the csv file. We  only want to see the criteria that lead to an airplanes delay, so we select the various categories such as ArrDelay and carrier delay. After sorting the data, we find that there are still many missing vairbales in teh data. these are removed and we are able to see that  that there are relatively fewer security and Nas delays. In fact the most tiem consuming delays come from carrier delays. 

```{r, eval=FALSE}
#more data cleaning. need to ensure duplicates are removed
##collin helped with this

flights.delayed.m = subset (flights.delayed.m, flights.delayed.m$ArrDelay!=0)

summary(flights.delayed.m)

#as in class, create the lienar model for testing 
flights.delayed.l = lm(data=flights.delayed.m, ArrDelay ~ TypeOfDelay)

flights.delayed.l

flights.delayed.a = aov(flights.delayed.l)

flights.delayed.a

flights.delayed.l.as = summary(flights.delayed.l)

flights.delayed.l.as


#Musing ggplot to plot results
flights.delayed.ggp = ggplot(flights.delayed.m, aes(x=TypeOfDelay, y=ArrDelay)) +
  stat_boxplot(geom="errorbar") +
  geom_boxplot() +
  labs(y="TimeOfDelay", x="TypeOfDelay")

flights.delayed.ggp

```

The ggplot above simply visually represents what was stated above. A graph is created showing that ArrDelay and Carrier delay have the greatest range, however the mean delay is all relatively about the same. Security delay appeared to have the smallest range by far, but the mean oraverage delay time was still similar to NAS delay and slightly below AirCraft delay 

```{r, eval=FALSE}
#analyze different potentially different outcomes
#source: matt
delayed.l.t = TukeyHSD(flights.delayed.a)
delayed.l.t

leveneTest(flights.delayed.l)

degrees = anova(flights.delayed.l)[, "Df"]
names(degrees) = c("between", "within")
f.crit = qf(.05, degrees["between"], degrees["within"], lower.tail=FALSE)
f.value = flights.delayed.l.as[[1]]$`F value`[1]
f.crit
f.value

#annnova plot and graph. this was from class

ncp = 0
frameEmpty = "black"
areaEmpty = "white"
frameH0 = "green4"
areaH0 = "green3"
frameH1 = "red4"
areaH1 = "red2"

#creating the distribution settings

df1 = degrees[1] 
df2 = degrees[2] 
length = 500 

x = seq(from = 0, to = f.value +2, length = length) 
dd = data.frame (x =seq (from = 0, to = f.value+2, length = length),
                 y = df (x = x, df1 = df1, df2 = df2, ncp = ncp))

#f Plot
pf = ggplot(data = dd) 
pf = pf + labs(y = "Relative frequency", x = "F-values") 
pf = pf + geom_area (aes(x = x, y = y),
                     color = frameH0, fill = areaH0) 
pf = pf + geom_area(data = subset(dd, x > f.crit),
                    aes(x = x, y = y),
                    fill = areaH1, color = frameH1) 
pf = pf + geom_vline (xintercept = f.crit, colour = frameH1, linetype = "longdash")
pf = pf + geom_vline (xintercept = f.value, colour = "black", linetype = "dotted")
pf = pf + scale_x_continuous(breaks = sort(round(c(seq(from = min(dd$x),
                                                       to = round (max (dd$x), 0),
                                                       by = 2), f.crit, f.value, 2))))
pf = pf + annotate ("text", y = .6, x = f.value + 1,
                    label = paste ("Pr(>F) = ", round(flights.delayed.l.as[[1]]$Pr[1],3)))
pf

# collin and matt assited throughout the annova analysis
##the graph is taken from your code 


```

The turkey and f plot tests allow us to compare the delay types to one another. From the turkey test we found that security delay and Nas differ in their means. 
The ggplot shows that while the majorityof flights have similiar delay times, various  categories do include more outliers which are significantly larger than the mean. 

*as stated in the code there were multiple parts in which i required assitance from my group partner collin and matt. 